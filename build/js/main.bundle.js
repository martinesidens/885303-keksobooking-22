(()=>{"use strict";const e=document.querySelector("#success").content;function t(){const t=document.querySelector("main");t.appendChild(e);const r=t.querySelector(".success");r.addEventListener("click",(e=>{o(t,r),g()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(e.preventDefault(),o(t,r),g())}))}function o(e,t){e.removeChild(t)}function r(){const e=document.querySelector("main"),t=document.querySelector("#error").content;e.appendChild(t);const r=e.querySelector(".error"),n=r.querySelector(".error__button");r.addEventListener("click",(()=>{o(e,r),g()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&o(e,r)})),n.addEventListener("click",(()=>{r.classList.add("hidden")}))}const n=document.querySelector(".ad-form"),a=n.querySelectorAll("fieldset"),c=document.querySelector(".map__filters"),s=c.querySelectorAll("select"),i=document.querySelector("#price"),d=document.querySelector("#room_number"),u=document.querySelector("#capacity"),l=document.querySelector(".ad-form__reset"),p=document.querySelector("#title"),f={flat:1e3,bungalow:0,house:5e3,palace:1e4},m=u[2],y=u[1],h=u[0],v=u[3];function b(){n.classList.toggle("ad-form--disabled"),c.classList.toggle("ad-form--disabled"),a.forEach((e=>{e.toggleAttribute("disabled")})),s.forEach((e=>{e.toggleAttribute("disabled")})),S(),m.hasAttribute("disabled")&&m.removeAttribute("disabled")}function g(){document.querySelector(".ad-form").reset(),document.querySelector("#address").value="",k.value="35.68951, 139.69200",x.setLatLng([E,w])}function S(){m.setAttribute("disabled","disabled"),y.setAttribute("disabled","disabled"),h.setAttribute("disabled","disabled"),v.setAttribute("disabled","disabled")}document.querySelector("#type").addEventListener("change",(function(e){const t=e.target.value;i.value=f[t],i.placeholder=f[t]})),document.querySelector("#timein").addEventListener("change",(function(e){const t=e.target.value,o=document.querySelector("#timeout");switch(t){case"12:00":o.value="12:00";break;case"13:00":o.value="13:00";break;case"14:00":o.value="14:00"}})),document.querySelector("#timeout").addEventListener("change",(function(e){const t=e.target.value,o=document.querySelector("#timein");switch(t){case"12:00":o.value="12:00";break;case"13:00":o.value="13:00";break;case"14:00":o.value="14:00"}})),p.addEventListener("input",(()=>{const e=p.value.length;e<30?p.setCustomValidity(`Добавьте ещё ${30-e} символов`):e>100?p.setCustomValidity(`Удалите лишние ${e-100} символы`):p.setCustomValidity(""),p.reportValidity()})),i.addEventListener("input",(()=>{i.value>1e6?i.setCustomValidity("Введенная сумма превышает максимально возможное значение"):i.setCustomValidity(""),i.reportValidity()})),d.addEventListener("change",(()=>{"100"===d.value?(S(),v.removeAttribute("disabled")):"1"===d.value?(S(),m.removeAttribute("disabled")):"2"===d.value?(S(),m.removeAttribute("disabled"),y.removeAttribute("disabled")):"3"===d.value&&(S(),m.removeAttribute("disabled"),y.removeAttribute("disabled"),h.removeAttribute("disabled"))})),l.addEventListener("click",g),n.addEventListener("submit",(e=>{var o;e.preventDefault(),o=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{if(e.ok)return e;throw new Error(`${e.status} ${e.statusText}`)})).then(t).catch(r)}));const q=document.querySelector("#card").content,k=document.querySelector("#address");k.value="35.68951, 139.69200";const E=35.68951,w=139.692,A=L.icon({iconUrl:"../img/main-pin.svg",iconSize:[38,95],iconAnchor:[26,52],popupAnchor:[-3,-76],shadowSize:[68,95],shadowAnchor:[22,94]}),x=L.marker({lat:E,lng:w},{draggable:!0,icon:A}),C=L.icon({iconUrl:"../img/pin.svg",iconSize:[38,95],iconAnchor:[26,52],popupAnchor:[-3,-76],shadowSize:[68,95],shadowAnchor:[22,94]}),$=L.marker({icon:C}),F=L.map("map-canvas");function V(e){e.forEach((()=>{$.remove()}))}b();const z=document.querySelector(".map__filters"),T=[];function j(e){V(e);const t=new FormData(z);for(const e of t.values())T.push(e);!function(e){V(e),e.forEach((e=>{!function(e){const t=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:C});t.addTo(F),t.bindPopup(function(e){const t=q.cloneNode(!0);t.querySelector(".popup__title").textContent=e.offer.title,t.querySelector(".popup__text--address").textContent=e.offer.address,t.querySelector(".popup__text--price").textContent=`${e.offer.price} ₽/ночь`;let o=e.offer.type;switch(o){case"flat":o="Квартира";break;case"bungalow":o="Бунгало";break;case"house":o="Дом";break;case"palace":o="Дворец"}return t.querySelector(".popup__type").textContent=o,t.querySelector(".popup__text--capacity").textContent=`${e.offer.rooms} комнаты для ${e.offer.guests} гостей.`,t.querySelector(".popup__text--time").textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,e.offer.features.forEach((e=>{t.querySelector(`.popup__feature--${e}`).classList.remove("hidden")})),e.offer.photos.forEach((e=>{const o=t.querySelector(".popup__photo").cloneNode(!1);o.src=e,o.classList.remove("hidden"),t.querySelector(".popup__photos").appendChild(o)})),t.querySelector(".popup__avatar").src=e.author.avatar,t}(e))}(e)}))}(e.filter((e=>U(e.offer.price)===function(e,t){if(e.includes(t,0))return t}(T,U(e.offer.price))||e.offer.type===D(T,e.offer.type)||e.offer.rooms===D(T,e.offer.rooms)||e.offer.guests===D(T,e.offer.guests)||void e.offer.features.forEach((e=>{if(e===D(T,e))return!0})))))}function D(e,t){if(e.includes(t,0))return t}function U(e){return e>1e4&&e<5e4?"middle":e<1e4?"low":e>5e4?"high":void 0}const N=["gif","jpg","jpeg","png"],O=document.querySelector(".ad-form-header__input"),P=document.querySelector(".ad-form-header__preview img");fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>e)).catch((()=>{!function(e){const t=document.createElement("div");var o;t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="#FF7F50",t.textContent=e,document.body.append(t),o=t,setTimeout((()=>{o.remove()}),1e4)}("Отсутствует соединение с сервером. Проверьте подключение к интернету.")})).then(_.debounce((function(e){z.addEventListener("change",j.bind(void 0,e))}),500)),F.on("load",(()=>{b(),k.value="35.68951, 139.69200"})).setView([E,w],10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(F),x.addTo(F),x.on("moveend",(e=>{document.querySelector("#address").value=`${parseFloat(e.target.getLatLng().lat).toFixed(5)}, ${parseFloat(e.target.getLatLng().lng).toFixed(5)}`})),O.addEventListener("change",(()=>{const e=O.files[0],t=e.name.toLowerCase();if(N.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{P.src=t.result})),t.readAsDataURL(e)}}))})();
//# sourceMappingURL=main.bundle.js.map